#! /usr/bin/env perl

use strict;
use warnings;

use File::Slurp;
use YAML;

my $usage = "Usage: $0 -o dir html_file\n";

my ($opt, $dir, $in_file) = @ARGV;

die $usage if $opt ne '-o';
die "Not a directory: $dir\n$usage" if ! -d $dir;
die "Not named *.html: $in_file\n$usage" if $in_file !~ /\.html$/;
die "No such file: $in_file\n$usage" if ! -f $in_file;


my $line_no = 0;
my $level = 0;

for my $line (read_file($in_file)) {
    $line_no++;
    $line =~ s/\s+$//;

    if ($line =~ /<h(\d)/) {
        $level = $1;
        print "  "x$level ."$line\n";
    } elsif ($line =~ m{<p class="sp2">}) {
        print "  "x($level + 2) ."$line\n";
    }
}


